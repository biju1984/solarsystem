<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Solar System Simulation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128/examples/js/controls/OrbitControls.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }

      canvas {
        display: block;
        background: black;
      }
    </style>
  </head>

  <body>
    <script>
      let scene = new THREE.Scene();
      let camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        10000
      );
      let renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      let textureLoader = new THREE.TextureLoader();

      // Ambient Light
      let ambientLight = new THREE.AmbientLight(0xffffff, 1.2);
      scene.add(ambientLight);

      // Background Stars
      let starGeometry = new THREE.BufferGeometry();
      let starVertices = [];
      for (let i = 0; i < 5000; i++) {
        let x = (Math.random() - 0.5) * 10000;
        let y = (Math.random() - 0.5) * 10000;
        let z = (Math.random() - 0.5) * 10000;
        starVertices.push(x, y, z);
      }
      starGeometry.setAttribute(
        "position",
        new THREE.Float32BufferAttribute(starVertices, 3)
      );
      let starMaterial = new THREE.PointsMaterial({
        color: 0xffffff,
        size: 1.5,
      });
      let stars = new THREE.Points(starGeometry, starMaterial);
      scene.add(stars);

      function createLabeledObject(name, size, texturePath, emissiveColor) {
        let geometry = new THREE.SphereGeometry(size, 64, 64);
        let material = new THREE.MeshStandardMaterial({
          map: textureLoader.load(texturePath),
          emissive: emissiveColor,
          emissiveIntensity: 2,
        });
        let planet = new THREE.Mesh(geometry, material);
        planet.name = name;
        let labelDiv = document.createElement("div");
        labelDiv.style.position = "absolute";
        labelDiv.style.color = "white";
        labelDiv.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
        labelDiv.style.padding = "4px";
        labelDiv.style.fontSize = "12px";
        labelDiv.innerHTML = name;
        document.body.appendChild(labelDiv);

        planet.label = labelDiv;

        return planet;
      }

      // Sun with rotation
      let sun = createLabeledObject("Sun", 90, "./sun.jpg", 0xff4500);
      scene.add(sun);

      // Function to add rings (for Saturn)
      function createRings(planet, innerRadius, outerRadius, texturePath) {
        let segments = 64;
        let ringGeometry = new THREE.BufferGeometry();
        let positions = [];
        let uvs = [];
        let indices = [];

        for (let i = 0; i <= segments; i++) {
          let angle = (i / segments) * Math.PI * 2;
          let xInner = innerRadius * Math.cos(angle);
          let zInner = innerRadius * Math.sin(angle);
          let xOuter = outerRadius * Math.cos(angle);
          let zOuter = outerRadius * Math.sin(angle);

          positions.push(xInner, 0, zInner, xOuter, 0, zOuter);
          uvs.push(i / segments, 0, i / segments, 1);

          if (i < segments) {
            let base = i * 2;
            indices.push(
              base,
              base + 1,
              base + 2,
              base + 1,
              base + 3,
              base + 2
            );
          }
        }

        ringGeometry.setAttribute(
          "position",
          new THREE.Float32BufferAttribute(positions, 3)
        );
        ringGeometry.setAttribute(
          "uv",
          new THREE.Float32BufferAttribute(uvs, 2)
        );
        ringGeometry.setIndex(indices);

        let ringMaterial = new THREE.MeshBasicMaterial({
          map: textureLoader.load(texturePath),
          side: THREE.DoubleSide,
          transparent: true,
          opacity: 0.6,
        });

        let ring = new THREE.Mesh(ringGeometry, ringMaterial);

        // Fix ring rotation to be horizontal instead of perpendicular
        ring.rotation.y = -Math.PI / 2; // Ensures the rings are aligned in Saturn's plane

        planet.add(ring);
      }

      let planets = [];
      let planetData = [
        {
          name: "Mercury",
          size: 2.4,
          distance: 100,
          speed: 0.004,
          texture: "./mercury.jpg",
          glow: "C07B41",
          moons: [],
        },
        {
          name: "Venus",
          size: 6,
          distance: 145,
          speed: 0.003,
          texture: "./venus2.jpg",
          glow: "C07B41",
          moons: [],
        },
        {
          name: "Earth",
          size: 6.4,
          distance: 200,
          speed: 0.002,
          texture: "./earth.jpg",
          glow: "718ff8",
          moons: [
            {
              name: "Moon",
              size: 1.7,
              distance: 10,
              speed: 0.01,
              texture: "./moon.jpg",
            },
          ],
        },
        {
          name: "Mars",
          size: 3.4,
          distance: 240,
          speed: 0.0015,
          texture: "./mars.jpg",
          glow: "C07B41",
          moons: [
            {
              name: "Phobos",
              size: 0.9,
              distance: 5,
              speed: 0.015,
              texture: "./phobos.png",
            },
            {
              name: "Deimos",
              size: 0.5,
              distance: 8,
              speed: 0.012,
              texture: "./deimos.png",
            },
          ],
        },
        {
          name: "Jupiter",
          size: 40,
          distance: 360,
          speed: 0.0008,
          texture: "./jupiter.jpg",
          glow: "C07B41",
          moons: [
            {
              name: "Io",
              size: 2.5,
              distance: 45,
              speed: 0.007,
              texture: "./io.png",
            },
            {
              name: "Europa",
              size: 2.3,
              distance: 50,
              speed: 0.006,
              texture: "./europa.png",
            },
            {
              name: "Ganymede",
              size: 2.7,
              distance: 55,
              speed: 0.005,
              texture: "./ganymede.png",
            },
            {
              name: "Callisto",
              size: 2.6,
              distance: 60,
              speed: 0.004,
              texture: "./callisto.png",
            },
          ],
        },
        {
          name: "Saturn",
          size: 28,
          distance: 480,
          speed: 0.0005,
          texture: "./saturn.jpg",
          glow: "C07B41",
          rings: true,
          ringTexture: "./saturn_ring.jpg",
          moons: [
            {
              name: "Titan",
              size: 3.2,
              distance: 36,
              speed: 0.006,
              texture: "./titan.png",
            },
            {
              name: "Enceladus",
              size: 1.1,
              distance: 32,
              speed: 0.008,
              texture: "./enceladus.png",
            },
          ],
        },
        {
          name: "Uranus",
          size: 15,
          distance: 590,
          speed: 0.0003,
          texture: "./uranus.jpg",
          glow: "C07B41",
          moons: [],
        },
        {
          name: "Neptune",
          size: 14,
          distance: 700,
          speed: 0.0002,
          texture: "./neptune.jpg",
          glow: "718ff8",
          moons: [
            {
              name: "Triton",
              size: 2.5,
              distance: 20,
              speed: 0.007,
              texture: "./triton.png",
            },
          ],
        },
      ];
      function createMoon(parentPlanet, moonData) {
        let moonGeometry = new THREE.SphereGeometry(moonData.size, 32, 32);
        let moonMaterial = new THREE.MeshStandardMaterial({
          map: textureLoader.load(moonData.texture),
        });
        let moon = new THREE.Mesh(moonGeometry, moonMaterial);
        moon.name = moonData.name;

        // ✅ Set moon’s initial position relative to the planet
        let moonInitialPosition = new THREE.Vector3(moonData.distance, 0, 0);
        moon.position.copy(moonInitialPosition);

        // parentPlanet.mesh.add(moon); // ✅ Attach moon to planet so it moves with it
        scene.add(moon);

        return {
          mesh: moon,
          speed: moonData.speed,
          distance: moonData.distance,
          angle: Math.random() * Math.PI * 2,
        };
      }

      planetData.forEach((data) => {
        let planet = createLabeledObject(
          data.name,
          data.size,
          data.texture,
          data.glow
        );
        scene.add(planet);

        let planetObject = {
          name: data.name,
          mesh: planet,
          speed: data.speed,
          distance: data.distance,
          angle: Math.random() * Math.PI * 2,
          moons: [],
        };

        if (data.moons) {
          data.moons.forEach((moonData) => {
            let moon = createMoon(planetObject, moonData);
            planetObject.moons.push(moon);
          });
        }

        planets.push(planetObject);

        if (data.rings) {
          createRings(
            planet,
            data.size * 1.5,
            data.size * 2.5,
            data.ringTexture
          );
        }
      });

      let controls = new THREE.OrbitControls(camera, renderer.domElement);
      camera.position.set(0, 0, 1000);
      controls.update();

      function animate() {
        requestAnimationFrame(animate);

        sun.rotation.y += 0.002; // Rotate the Sun

        planets.forEach((planet) => {
          planet.angle += planet.speed;
          planet.mesh.position.x = planet.distance * Math.cos(planet.angle);
          planet.mesh.position.z = planet.distance * Math.sin(planet.angle);
          planet.mesh.rotation.y += 0.02;

          planet.moons.forEach((moon) => {
            moon.angle += moon.speed;

            // ✅ Moon orbits around the planet
            let moonX = moon.distance * Math.cos(moon.angle);
            let moonZ = moon.distance * Math.sin(moon.angle);

            let planetPosition = planet.mesh.position;

            // ✅ Keep moon’s position relative to the planet
            moon.mesh.position.set(
              planetPosition.x + moonX,
              planetPosition.y,
              planetPosition.z + moonZ
            );

            // ✅ Add self-rotation (moon spinning around its axis)
            moon.mesh.rotation.y += 0.02; // Adjust the speed if needed
          });

          let vector = new THREE.Vector3();
          planet.mesh.getWorldPosition(vector);
          let coords = vector.project(camera);
          let x = (coords.x * 0.5 + 0.5) * window.innerWidth;
          let y = (coords.y * -0.5 + 0.5) * window.innerHeight;
          planet.mesh.label.style.transform = `translate(${x}px, ${y}px)`;
        });

        renderer.render(scene, camera);
      }

      let controlsContainer = document.createElement("div");
      controlsContainer.style.position = "absolute";
      controlsContainer.style.top = "10px";
      controlsContainer.style.left = "10px";
      controlsContainer.style.zIndex = "100";
      controlsContainer.style.background = "rgba(0, 0, 0, 0.5)";
      controlsContainer.style.padding = "10px";
      controlsContainer.style.borderRadius = "10px";
      document.body.appendChild(controlsContainer);

      // Create buttons for each planet
      function createPlanetButton(planet, index) {
        let button = document.createElement("button");
        button.innerText = planet.name;
        button.style.margin = "5px";
        button.style.padding = "8px";
        button.style.cursor = "pointer";
        button.style.border = "none";
        button.style.background = "#fff";
        button.style.color = "#000";
        button.style.borderRadius = "5px";

        button.addEventListener("click", () =>
          moveCameraTo(planets[index].mesh)
        );
        controlsContainer.appendChild(button);

        planet.moons.forEach((moon) => {
          if (moon && moon.mesh) {
            // Ensure the moon object exists and has a mesh property
            let moonButton = document.createElement("button");
            moonButton.innerText = `${planet.name} - ${
              moon.mesh.name || moon.name
            }`;
            moonButton.style.margin = "3px";
            moonButton.style.padding = "6px";
            moonButton.style.cursor = "pointer";
            moonButton.style.border = "none";
            moonButton.style.background = "#ccc";
            moonButton.style.color = "#000";
            moonButton.style.borderRadius = "5px";

            moonButton.addEventListener("click", () => moveCameraTo(moon.mesh));
            controlsContainer.appendChild(moonButton);
          }
        });
      }

      // Create a button for the Sun
      let sunButton = document.createElement("button");
      sunButton.innerText = "Sun";
      sunButton.style.margin = "5px";
      sunButton.style.padding = "8px";
      sunButton.style.cursor = "pointer";
      sunButton.style.border = "none";
      sunButton.style.background = "#ff4500";
      sunButton.style.color = "#fff";
      sunButton.style.borderRadius = "5px";
      sunButton.addEventListener("click", () => moveCameraTo(sun));
      controlsContainer.appendChild(sunButton);

      planetData.forEach((planet, index) => {
        createPlanetButton(planet, index);
      });

      function createMoonButtons() {
        planets.forEach((planet) => {
          planet.moons.forEach((moon) => {
            if (moon && moon.mesh) {
              // Create a button for each moon
              let moonButton = document.createElement("button");
              moonButton.innerText = `${planet.name} - ${
                moon.mesh.name || moon.name
              }`;
              moonButton.style.margin = "3px";
              moonButton.style.padding = "6px";
              moonButton.style.cursor = "pointer";
              moonButton.style.border = "none";
              moonButton.style.background = "#ccc";
              moonButton.style.color = "#000";
              moonButton.style.borderRadius = "5px";

              // Add event listener to move camera to the moon when clicked
              moonButton.addEventListener("click", () =>
                moveCameraTo(moon.mesh)
              );

              // Append button to the controls container
              controlsContainer.appendChild(moonButton);
            }
          });
        });
      }

      // Call this function after planets and moons are initialized
      createMoonButtons();

      function moveCameraTo(target) {
        let targetPosition = new THREE.Vector3();
        target.getWorldPosition(targetPosition);

        camera.position.set(
          targetPosition.x + 50,
          targetPosition.y + 30,
          targetPosition.z + 50
        );
        controls.target.copy(targetPosition);
        controls.update();
      }

      animate();
    </script>
  </body>
</html>
